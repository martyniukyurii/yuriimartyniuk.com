# Налаштування синхронізації Telegram на Vercel

Ця інструкція пояснює, як налаштувати автоматичну синхронізацію вашого Telegram каналу з блогом на платформі Vercel.

## Огляд процесу

Оскільки Vercel не дозволяє запускати постійні фонові процеси (як-от CRON задачі), ми використовуємо два підходи:

1. **Vercel Cron Jobs** - для регулярного автоматичного запуску синхронізації
2. **API Endpoint** - для ручного запуску синхронізації за потреби

## Підготовка змінних середовища

1. Створіть файл `.env.local` на основі `.env.local.example` і заповніть усі необхідні значення
2. Згенеруйте випадковий API ключ для захисту ендпоінта синхронізації:
   ```
   TELEGRAM_SYNC_API_KEY=abcdef123456
   ```

## Налаштування Vercel Cron Jobs

1. У файлі `vercel.json` додайте конфігурацію для Cron:

```json
{
  "crons": [
    {
      "path": "/api/sync-telegram?apiKey=YOUR_API_KEY_HERE",
      "schedule": "0 * * * *"
    }
  ]
}
```

Ця конфігурація буде запускати синхронізацію кожну годину (в 0 хвилин). Розклад задається у форматі CRON: 

- `0 * * * *` - кожну годину
- `*/30 * * * *` - кожні 30 хвилин
- `0 */6 * * *` - кожні 6 годин
- `0 0 * * *` - раз на день (опівночі)

2. Замініть `YOUR_API_KEY_HERE` на значення, яке ви встановили для `TELEGRAM_SYNC_API_KEY`.

## Налаштування змінних середовища у Vercel

1. У панелі керування Vercel перейдіть до налаштувань вашого проекту
2. Перейдіть до розділу "Environment Variables"
3. Додайте всі змінні з вашого `.env.local` файлу:
   - `MONGODB_URI`
   - `TELEGRAM_API_ID`
   - `TELEGRAM_API_HASH`
   - `TELEGRAM_SESSION_KEY` 
   - `TELEGRAM_CHANNEL_USERNAME`
   - `TELEGRAM_SYNC_API_KEY`
4. Додайте `VERCEL=1` для виявлення середовища Vercel

## Ручний запуск синхронізації

Ви можете запустити синхронізацію в будь-який момент, зробивши GET-запит до API ендпоінту:

```
https://your-site.vercel.app/api/sync-telegram?apiKey=YOUR_API_KEY
```

Для зручності можна використовувати такі інструменти як:
- cURL у терміналі
- Postman для тестування API
- Простий HTTP-клієнт у браузері

## Обмеження на Vercel

Зверніть увагу на обмеження Vercel:

1. Безкоштовний план Vercel має ліміт на кількість Cron задач (зазвичай 1-2 задачі)
2. Функції мають обмежений час виконання (для Hobby плану - до 10 секунд)
3. Файли, завантажені під час виконання, не зберігаються (тому парсер на Vercel не зберігає медіафайли)

Для повноцінної роботи з медіафайлами рекомендується:
- Використовувати хмарне сховище (S3, Firebase тощо) для зберігання медіа
- Або налаштувати парсер на окремому сервері з повним доступом до файлової системи

## Тестування та діагностика

Після налаштування Cron задачі на Vercel:

1. Перейдіть в логи вашого проекту на Vercel
2. Перевірте, чи з'являються логи виконання задачі синхронізації
3. У разі помилок перевірте, чи правильно встановлені всі змінні середовища 